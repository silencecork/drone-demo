pipeline:
  install:
    image: node:10.15
    commands:
      - node -v
      - npm -v
      - npm install
      - npm install -g mocha
      - mocha test/api.js
  scp:
    image: appleboy/drone-scp
    host: 
      - 13.230.240.54
    port: 22
    secrets: 
      - source: password
        target: scp_password
      - source: username
        target: scp_username
    rm: true
    target: /home/ec2-user/data/drone-demo
    source: 
      - "*.*"
      - "test/*.*"
      #- "*.js"
      #- "*.json"
      #- "test/*.json"
    when:
      branch: master
      local: true

  install:
    image: appleboy/drone-ssh
    host: 52.197.108.200
    username: ec2-user
    secrets: 
      - source: password
        target: ssh_password
    script:
      - pwd
      - cd /home/ec2-user/data/drone-demo
      - pwd
      - echo "start to install"
      - npm install
      - mocha test/api.js
    